<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_module">
    <sys_module action="INSERT_OR_UPDATE">
        <content><![CDATA[import { gs, GlideDateTime } from '@servicenow/glide'

export function calculateOverallScore(current, previous) {
    const scores = [
        current.getValue('manageability_score'),
        current.getValue('performance_score'), 
        current.getValue('security_score'),
        current.getValue('upgradability_score'),
        current.getValue('user_experience_score')
    ];
    
    // Calculate average score (only for non-empty scores)
    const validScores = scores.filter(score => score && !isNaN(parseInt(score)));
    
    if (validScores.length > 0) {
        const sum = validScores.reduce((total, score) => total + parseInt(score), 0);
        const average = Math.round(sum / validScores.length);
        current.setValue('overall_score', average);
    }
    
    // Set submitted_on timestamp when status changes to submitted
    if (current.getValue('status') === 'submitted' && 
        (previous === null || previous.getValue('status') !== 'submitted')) {
        current.setValue('submitted_on', new GlideDateTime().getDisplayValue());
        current.setValue('completed', true);
    }
    
    // Reset submitted_on if status changes back from submitted
    if (previous && previous.getValue('status') === 'submitted' && 
        current.getValue('status') !== 'submitted') {
        current.setValue('submitted_on', '');
        current.setValue('completed', false);
    }
}]]></content>
        <external_source>false</external_source>
        <path>x_1460650_core_pri/x-1460650-core-princip/1.0.0/src/server/assessment-calculations.js</path>
        <sys_class_name>sys_module</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2025-11-28 15:59:45</sys_created_on>
        <sys_id>159ed10afc3247238b8e73652b4ecfd9</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name>x_1460650_core_pri/x-1460650-core-princip/1.0.0/src/server/assessment-calculations.js</sys_name>
        <sys_package display_value="Core Princip" source="x_1460650_core_pri">83768decc3a5f210e4deb132b4013162</sys_package>
        <sys_policy/>
        <sys_scope display_value="Core Princip">83768decc3a5f210e4deb132b4013162</sys_scope>
        <sys_update_name>sys_module_159ed10afc3247238b8e73652b4ecfd9</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2025-11-28 15:59:45</sys_updated_on>
    </sys_module>
</record_update>
